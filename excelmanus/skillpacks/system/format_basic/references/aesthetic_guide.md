# Excel 审美设计指南

本指南是 agent 构建专业、美观 Excel 表格的完整参考。策略文件 `formatting.md` 和 `table_layout.md` 提供了始终注入的基础规则，本文档提供深入的设计原则、色板、模板和反模式清单，供格式化/美化任务时按需查阅。

---

## 一、核心设计哲学

### 1.1 少即是多（Less is More）

专业表格的标志不是"用了多少格式"，而是"克制了多少格式"。每一个样式决策都应有明确目的：

- **有目的地使用颜色**：颜色用于传达含义（警告、分类、强调），不用于装饰。
- **有目的地使用边框**：边框用于区分区域，不用于画格子。
- **有目的地使用字体变化**：加粗/字号用于建立层级，不用于"让某些字好看"。

### 1.2 一致性优于个性

- 同一工作簿中所有 sheet 遵循相同的样式标准（字体、配色、对齐规则）。
- 同一列的数据格式必须统一（不能前 10 行是 `0.00%` 后 10 行是 `0%`）。
- 同一表格中同类元素（如所有表头）的样式必须完全一致。

### 1.3 功能驱动美学

美观永远服务于可读性和可理解性：
- 读者能在 3 秒内找到最重要的数据 → 成功
- 读者需要花时间辨认哪些是标题、哪些是数据 → 失败
- 打印出来仍然清晰可读 → 成功

---

## 二、配色体系

### 2.1 三色原则

每张表格只使用 **3 种颜色角色**：

| 角色 | 用途 | 面积占比 |
|------|------|---------|
| **主色** | 标题底色、表头底色 | ~5–10% |
| **辅色** | 强调、条件格式高亮 | ~2–5% |
| **中性色** | 交替行底色、边框、次要文字 | ~10–15% |

其余 70–80% 应为白底 + 黑/深灰文字。

### 2.2 五套专业色板

以下色板经过对比度验证，可直接用于生产：

#### 色板 A：商务蓝（默认推荐）
| 角色 | 颜色名 | 十六进制 | 用途示例 |
|------|--------|---------|---------|
| 主色 | 深蓝 | 002060 | 标题底色（配白字） |
| 表头底 | 天蓝 | 4472C4 | 表头行底色（配白字） |
| 辅色 | 橙色 | ED7D31 | 关键数据强调 |
| 交替行 | 极浅蓝 | D6E4F0 | 偶数行底色 |
| 中性 | 浅灰 | F2F2F2 | 备用交替行 |

#### 色板 B：沉稳绿
| 角色 | 颜色名 | 十六进制 | 用途示例 |
|------|--------|---------|---------|
| 主色 | 深绿 | 375623 | 标题底色（配白字） |
| 表头底 | 草绿 | 70AD47 | 表头行底色（配白字） |
| 辅色 | 金色 | FFC000 | 关键数据强调 |
| 交替行 | 极浅绿 | E2EFDA | 偶数行底色 |
| 中性 | 浅灰 | F2F2F2 | 备用交替行 |

#### 色板 C：专业灰
| 角色 | 颜色名 | 十六进制 | 用途示例 |
|------|--------|---------|---------|
| 主色 | 深灰 | 404040 | 标题底色（配白字） |
| 表头底 | 中灰 | 808080 | 表头行底色（配白字） |
| 辅色 | 天蓝 | 4472C4 | 关键数据强调 |
| 交替行 | 极浅灰 | F5F5F5 | 偶数行底色 |
| 中性 | 浅灰 | E0E0E0 | 边框色 |

#### 色板 D：暖色调
| 角色 | 颜色名 | 十六进制 | 用途示例 |
|------|--------|---------|---------|
| 主色 | 暗红 | 823535 | 标题底色（配白字） |
| 表头底 | 砖红 | C0504D | 表头行底色（配白字） |
| 辅色 | 金色 | FFC000 | 关键数据强调 |
| 交替行 | 极浅粉 | F2DCDB | 偶数行底色 |
| 中性 | 浅灰 | F2F2F2 | 备用交替行 |

#### 色板 E：深色高端
| 角色 | 颜色名 | 十六进制 | 用途示例 |
|------|--------|---------|---------|
| 主色 | 藏青 | 1B2A4A | 标题底色（配白字） |
| 表头底 | 钢蓝 | 2E75B6 | 表头行底色（配白字） |
| 辅色 | 琥珀 | BF8F00 | 关键数据强调 |
| 交替行 | 极浅蓝灰 | EDF2F9 | 偶数行底色 |
| 中性 | 银灰 | D0D0D0 | 边框色 |

### 2.3 配色禁忌

- **禁止彩虹**：不要给每列/每区域分配不同颜色。
- **禁止高饱和大面积填充**：纯红 FF0000、纯黄 FFFF00 等高饱和色不应作为大面积底色，仅用于小面积警示标记。
- **禁止亮底+亮字**：如黄底+浅绿字，对比度不足无法阅读。
- **禁止过多渐变**：Excel 渐变填充在打印和屏幕上效果不一致，应避免使用。

---

## 三、边框与网格

### 3.1 "无框优先"原则

现代专业表格趋势是**去除默认网格线**，用底色对比和留白来区分行列：

```
推荐做法：                     避免做法：
┌────────────────────┐        ┌──┬──┬──┬──┬──┐
│  标题区（深色底）    │        │  │  │  │  │  │
├────────────────────┤        ├──┼──┼──┼──┼──┤
│  表头（浅色底+粗下线）│       │  │  │  │  │  │
│  数据行（交替行色）   │       ├──┼──┼──┼──┼──┤
│  数据行（白底）      │        │  │  │  │  │  │
│  数据行（交替行色）   │       ├──┼──┼──┼──┼──┤
╞════════════════════╡        │  │  │  │  │  │
│  汇总行（加粗）      │       └──┴──┴──┴──┴──┘
└────────────────────┘        （满屏格子，视觉噪音大）
```

### 3.2 边框层级系统

| 位置 | 样式 | 颜色 | 说明 |
|------|------|------|------|
| 表头下方 | medium | 主色或深灰 | 分隔表头与数据的关键分界线 |
| 数据区行间 | thin 或无 | 浅灰 D9D9D9 | 密集数据才需要，优先用交替行色替代 |
| 数据区列间 | 无 | — | 列间不加竖线，靠列宽和对齐区分 |
| 汇总行上方 | double | 黑色或深灰 | 标志汇总区域开始 |
| 外边框 | thin 或无 | 浅灰 | 如需边界感可加，但非必须 |

### 3.3 合并单元格的边框

合并单元格内容始终 horizontal="center" + vertical="center"。合并区域的边框只设置外边框，内部不需要线条。

---

## 四、字体与排版

### 4.1 字体选择矩阵

| 场景 | 推荐字体 | 备选 |
|------|---------|------|
| 英文/数字为主 | Calibri | Arial, Segoe UI |
| 中文为主 | 微软雅黑 | 等线, 宋体（正式报告） |
| 等宽数字（财务） | Consolas | Courier New |

**铁律**：全表只用 1 种字体（中英文可各 1 种），禁止出现 3 种以上字体。

### 4.2 字号层级体系

```
大标题  ───  14–16pt  加粗  主色底白字
  │
副标题  ───  12–13pt  加粗  无底色/浅底色
  │
表头    ───  11–12pt  加粗  主色底白字 或 浅色底深色字
  │
正文    ───  10–11pt  常规  白底黑字
  │
注释    ───  9pt      常规  灰色字
```

层级之间字号差至少 1pt，不超过 4pt。

### 4.3 文字颜色规范

- **正文**：黑色 000000 或深灰 333333
- **次要信息/注释**：灰色 808080 或 999999
- **链接/可操作项**：蓝色 0563C1（Excel 默认超链接色）
- **警告/负值**：深红 C00000（不用纯红 FF0000，太刺眼）
- **正值/通过**：深绿 006100（不用纯绿 00FF00，屏幕刺眼）

---

## 五、留白与密度

### 5.1 呼吸空间

- **表格边缘**：数据从 B2 开始（留空 A 列和第 1 行），给表格呼吸空间。
- **区域间距**：多个表格/图表在同一 sheet 时，间隔至少 2 行或 2 列。
- **标题与表头之间**：如有大标题行，与下方表头之间可留 1 空行。

### 5.2 密集数据的可读性

行数超过 20 行的表格，**必须**使用以下至少一种手段：

1. **交替行色**（首选）：奇数行白色，偶数行极浅灰 F2F2F2
2. **分组空行**：每 5–10 行插入一行间距（适合财务报表）
3. **冻结窗格**：冻结表头行，确保滚动时始终可见列标题

### 5.3 单元格内边距

- 文字不应紧贴单元格边缘，通过适当的列宽和 `indent` 属性留出内边距。
- 左对齐的文本列建议 `indent=1`（约 1 字符缩进）。

---

## 六、数字格式美学

### 6.1 格式统一表

| 数据类型 | 推荐格式 | 示例 |
|---------|---------|------|
| 整数 | `#,##0` | 1,234 |
| 小数（2位） | `#,##0.00` | 1,234.56 |
| 百分比 | `0.0%` 或 `0.00%` | 85.5% |
| 金额（人民币） | `¥#,##0.00` | ¥1,234.56 |
| 金额（美元） | `$#,##0.00` | $1,234.56 |
| 日期 | `YYYY-MM-DD` | 2026-02-26 |
| 日期时间 | `YYYY-MM-DD HH:MM` | 2026-02-26 14:30 |
| 负数突出 | `#,##0.00;[Red]-#,##0.00` | -1,234.56（红色） |

### 6.2 关键规则

- 同一列**必须**使用完全相同的数字格式。
- 金额小数位数与业务精度一致（报价 2 位，汇率 4 位）。
- 百分比不要手动乘以 100 后写字符串，用 Excel 百分比格式让原始值保持小数。
- 大数字使用千分位分隔符提高可读性。

---

## 七、专业场景模板

### 7.1 财务报表风格

```
特征：保守配色（深蓝/灰为主）、严格对齐、千分位、双线汇总
─────────────────────────────────────────
  [深蓝底白字] 2026年度利润表
─────────────────────────────────────────
  [天蓝底白字加粗]  项目 │ Q1 │ Q2 │ Q3 │ Q4 │ 全年
─────────────────────────────────────────
  营业收入           1,234  1,456  1,389  1,567  5,646
  营业成本            (890)  (923)  (912)  (978) (3,703)
  毛利润              344    533    477    589   1,943
═════════════════════════════════════════
  净利润 [加粗]       210    398    345    456   1,409
```

关键要素：
- 负数用括号 `#,##0;(#,##0)` 而非负号
- 汇总行上方双线，文字加粗
- 层级缩进区分大类/小类
- 配色极简：仅深蓝 + 白 + 黑

### 7.2 数据仪表盘风格

```
特征：KPI 卡片区 + 数据表 + 图表，布局分区明确
──────────────────────────────────
  [大标题] 销售数据仪表盘 - 2026年2月
──────────────────────────────────
  [KPI 卡片区] （合并单元格，大号字体）
  总销售额        新客户数        完成率
  ¥2,345,678     156            87.5%
──────────────────────────────────
  [数据表区]  [图表区]
  ...           ...
```

关键要素：
- KPI 数字用 20–24pt 加粗，下方 9pt 灰色标签
- 区域间留 2 行间距
- 图表与数据表并排，起始行对齐

### 7.3 项目跟踪表风格

```
特征：状态色标、进度条（条件格式数据条）、冻结窗格
──────────────────────────────────────────
  [表头] 任务名 │ 负责人 │ 状态 │ 进度 │ 截止日期
──────────────────────────────────────────
  需求分析   张三   ● 已完成  100%   2026-01-15
  UI 设计    李四   ● 进行中   65%   2026-02-28
  后端开发   王五   ● 待开始    0%   2026-03-15
```

关键要素：
- 状态列用条件格式：已完成=绿底，进行中=蓝底，延期=红底
- 进度列用数据条（DataBarRule）可视化
- 冻结首行 + 首列

---

## 八、反模式清单

创建或修改表格时，**主动避免**以下常见审美错误：

| 编号 | 反模式 | 为什么不好 | 正确做法 |
|------|--------|----------|---------|
| X1 | 每个单元格四边粗框 | 视觉噪音大，像监狱栏杆 | 仅在关键分界处加线 |
| X2 | 5 种以上填充色 | 彩虹效果，无法分辨重点 | 三色原则 |
| X3 | 表头用 16pt+红色+加粗+倾斜 | 过度强调，喧宾夺主 | 12pt 加粗 + 底色即可 |
| X4 | 列宽不统一（忘记 auto_fit） | 文字被截断或大量空白 | 收尾必做 auto_fit |
| X5 | 同列混用不同数字格式 | 数据不可比较，不专业 | 同列严格统一格式 |
| X6 | 亮黄底+亮绿字 | 对比度不足，无法阅读 | 深色字配浅底 |
| X7 | 数据从 A1 顶格开始 | 表格紧贴边缘，局促 | 从 B2 开始，留呼吸空间 |
| X8 | 合并单元格不居中 | 内容偏向一角，不平衡 | 合并后 center+center |
| X9 | 标题、表头、正文同一字号 | 无视觉层级，无法快速定位 | 字号递减建立层级 |
| X10 | 使用 Comic Sans 等装饰字体 | 不专业，难以阅读 | Calibri/Arial/微软雅黑 |

---

## 九、决策流程图

遇到格式化/美化任务时，按以下顺序决策：

```
1. 感知现有样式（read_excel + read_cell_styles）
   ↓
2. 用户有明确风格要求？ → 遵循用户要求
   ↓ 无
3. 表格已有统一风格？ → 沿用现有风格，最小化改动
   ↓ 无
4. 判断场景类型：
   - 财务/会计 → 色板 A 或 C，财务报表模板
   - 销售/营销 → 色板 A 或 B，仪表盘模板
   - 项目管理 → 色板 A 或 E，跟踪表模板
   - 通用/不确定 → 色板 A（商务蓝，最安全）
   ↓
5. 按层级应用样式：标题 → 表头 → 数据区 → 汇总行
   ↓
6. 收尾：auto_fit 列宽行高 → 验证 → 交付
```

---

## 十、openpyxl 快速参考

### 10.1 专业表格一键样式（代码骨架）

```python
from openpyxl.styles import Font, PatternFill, Border, Side, Alignment

# ── 色板 A：商务蓝 ──
TITLE_FILL = PatternFill("solid", fgColor="002060")
TITLE_FONT = Font(name="Calibri", bold=True, size=14, color="FFFFFF")
HEADER_FILL = PatternFill("solid", fgColor="4472C4")
HEADER_FONT = Font(name="Calibri", bold=True, size=11, color="FFFFFF")
BODY_FONT = Font(name="Calibri", size=10, color="333333")
ALT_ROW_FILL = PatternFill("solid", fgColor="D6E4F0")
SUMMARY_FONT = Font(name="Calibri", bold=True, size=11, color="000000")
HEADER_BORDER_BOTTOM = Border(bottom=Side(style="medium", color="002060"))
SUMMARY_BORDER_TOP = Border(top=Side(style="double", color="000000"))
ALIGN_CENTER = Alignment(horizontal="center", vertical="center")
ALIGN_LEFT = Alignment(horizontal="left", vertical="center")
ALIGN_RIGHT = Alignment(horizontal="right", vertical="center")
```

### 10.2 交替行色应用

```python
for row_idx in range(data_start_row, data_end_row + 1):
    if row_idx % 2 == 0:
        for col_idx in range(min_col, max_col + 1):
            ws.cell(row=row_idx, column=col_idx).fill = ALT_ROW_FILL
```

### 10.3 按数据类型自动对齐

```python
from openpyxl.utils import get_column_letter
import re

for col_idx in range(min_col, max_col + 1):
    # 采样前 10 行判断数据类型
    sample = [ws.cell(row=r, column=col_idx).value
              for r in range(data_start_row, min(data_start_row + 10, data_end_row + 1))
              if ws.cell(row=r, column=col_idx).value is not None]
    numeric_count = sum(1 for v in sample if isinstance(v, (int, float)))
    is_numeric = numeric_count > len(sample) * 0.7

    align = ALIGN_RIGHT if is_numeric else ALIGN_LEFT
    for row_idx in range(data_start_row, data_end_row + 1):
        ws.cell(row=row_idx, column=col_idx).alignment = align
```
