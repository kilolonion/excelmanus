# ExcelManus CLI 实测任务集

> 基于 `.tmp/迎新活动排班表.xlsx` 的端到端测试方案
> 覆盖：读取理解 → 数据分析 → 跨表操作 → 格式化 → 图表 → 代码执行 → 文件管理 → 多轮对话

---

## 前置准备

启动 CLI 后，所有任务均围绕 `.tmp/迎新活动排班表.xlsx` 展开。
建议每个任务作为一轮独立对话，测试完一个再进入下一个。

---

## 任务 1：多表结构感知与数据读取

**难度**：⭐⭐ | **考察**：read_excel、list_sheets、header 自动检测

**Prompt**：
```
打开 .tmp/迎新活动排班表.xlsx，告诉我这个文件有几个工作表，每个表的结构是什么样的（列名、行数），并展示"学生花名册"前5行数据。
```

**验收标准**：
- 正确识别 7 个 Sheet
- 列出每个 Sheet 的列名和行数
- 展示花名册前 5 行预览数据

---

## 任务 2：多条件过滤 + 统计分析

**难度**：⭐⭐⭐ | **考察**：filter_data（多条件 AND/OR）、analyze_data

**Prompt**：
```
在"学生花名册"中，帮我筛选出所有"必须参加"的班干部（角色不是"普通同学"），按班级分组统计每个班有多少人必须参加，并找出哪个班自愿报名的人数最多。
```

**验收标准**：
- 正确使用 filter_data 或 run_code 进行多条件筛选
- 按班级分组统计
- 给出自愿报名最多的班级

---

## 任务 3：跨表 VLOOKUP 匹配写回

**难度**：⭐⭐⭐⭐ | **考察**：vlookup_write（macro_tools 核心能力）

**Prompt**：
```
我需要在"活动时段安排"表中新增一列"大组长联系电话"，从"学生花名册"中根据"大组长学号"匹配查找对应的联系电话并填入。
```

**验收标准**：
- 正确使用 vlookup_write 工具
- source_sheet=学生花名册, source_key=学号, source_values=联系电话
- target_sheet=活动时段安排, target_key=大组长学号
- 匹配成功率应接近 100%

---

## 任务 4：计算列 + 条件判断

**难度**：⭐⭐⭐ | **考察**：computed_column（声明式表达式）

**Prompt**：
```
在"统计汇总"表中，新增一列"参与等级"：参与率>=80%标记为"优秀"，60%-80%标记为"良好"，低于60%标记为"需加强"。
```

**验收标准**：
- 使用 computed_column 工具
- 正确使用 where() 嵌套条件表达式
- 结果列值正确反映参与率区间

---

## 任务 5：复杂数据变换（run_code）

**难度**：⭐⭐⭐⭐ | **考察**：run_code、pandas 多步操作

**Prompt**：
```
帮我做一个"班级参与度分析报告"：
1. 从"分组明细"表统计每个班级被分配到了多少个不同的时段和组别
2. 从"学生花名册"统计每个班的总人数、已报名人数
3. 将两个统计结果合并，计算每个班的"人均参与时段数"
4. 结果写入新的工作表"班级参与度分析"
```

**验收标准**：
- 使用 run_code 编写 pandas 脚本
- 正确进行跨表聚合和合并
- 新建工作表并写入结果
- 计算逻辑正确

---

## 任务 6：格式化与样式（run_code + openpyxl）

**难度**：⭐⭐⭐⭐ | **考察**：run_code 操作 openpyxl 样式

**Prompt**：
```
请美化"管理架构"表：
1. 第一层（年级长）行背景色设为深蓝色(#1F4E79)，白色字体，加粗
2. 第二层（大组长）行背景色设为中蓝色(#2E75B6)，白色字体
3. 第三层（组长）行背景色设为浅蓝色(#9DC3E6)
4. 所有单元格加细边框
5. 表头行加粗、居中、深灰背景
```

**验收标准**：
- 正确识别不同层级的行
- 样式应用准确（颜色、字体、边框）
- 不破坏原有数据

---

## 任务 7：图表生成

**难度**：⭐⭐⭐ | **考察**：run_code + matplotlib 图表

**Prompt**：
```
根据"统计汇总"表的数据，生成两张图表：
1. 各班级参与率的柱状图（横轴班级名，纵轴参与率百分比）
2. 必须参加 vs 自愿报名人数的堆叠柱状图
图表保存为 .tmp/参与率分析.png 和 .tmp/人员构成分析.png
```

**验收标准**：
- 生成两张 PNG 图表
- 图表标题、轴标签、图例完整
- 数据与统计汇总表一致

---

## 任务 8：新建工作表 + 跨表数据整合

**难度**：⭐⭐⭐⭐⭐ | **考察**：run_code 综合能力、多表联动

**Prompt**：
```
创建一个"人员总览"工作表，要求：
1. 从"学生花名册"获取所有已确认/已报名的学生
2. 从"分组明细"获取每个学生被分配到的时段和组别（一个学生可能出现在多个时段）
3. 从"管理架构"标记哪些学生担任了组长/大组长/年级长
4. 最终表格列：学号、姓名、班级、角色、参与时段数、担任职务、联系电话
5. 按"参与时段数"降序排列
```

**验收标准**：
- 正确整合 3 个表的数据
- 学生参与时段数统计准确
- 职务标记正确（组长/大组长/年级长）
- 排序正确

---

## 任务 9：文件操作 + 备份

**难度**：⭐⭐ | **考察**：copy_file、list_directory

**Prompt**：
```
帮我把当前的迎新活动排班表备份一份到 .tmp/backup/ 目录下，文件名加上今天的日期后缀。然后列出 .tmp 目录下所有文件。
```

**验收标准**：
- 正确复制文件
- 文件名包含日期
- 列出目录内容

---

## 任务 10：多轮对话 — 迭代修改

**难度**：⭐⭐⭐⭐ | **考察**：上下文记忆、多轮修改

**第一轮 Prompt**：
```
读取"活动时段安排"表，告诉我周六上午安排了哪些任务。
```

**第二轮 Prompt**：
```
我觉得周六上午的任务安排不太合理，帮我把A组的任务改成"新生心理辅导"，地点改为"心理咨询中心"。
```

**第三轮 Prompt**：
```
改完之后，帮我重新读取确认一下修改是否生效了。
```

**验收标准**：
- 第一轮正确读取并展示 T1 时段数据
- 第二轮正确定位并修改数据
- 第三轮验证修改结果

---

## 任务 11：错误恢复与边界处理

**难度**：⭐⭐⭐ | **考察**：错误处理、容错能力

**Prompt**：
```
在"学生花名册"中，帮我筛选"计算机1班"的学生。
```

**验收标准**：
- 应识别出"计算机1班"不存在
- 给出可用的班级列表
- 建议用户选择正确的班级名

---

## 任务 12：超复杂综合任务

**难度**：⭐⭐⭐⭐⭐ | **考察**：Plan 模式、多步推理、全工具链

**Prompt**：
```
帮我完成以下综合任务：
1. 统计每个时段（T1-T4）各组的实际分配人数，与"活动时段安排"表中的"组员人数"对比，找出差异
2. 对于人数不足的组（实际<计划），从"学生花名册"中筛选出同班级、未报名的普通同学作为候补名单
3. 将候补名单写入新工作表"候补人员"，包含：学号、姓名、班级、建议补充到的时段和组别
4. 生成一份差异汇总，写入新工作表"人数差异汇总"
```

**验收标准**：
- 正确计算计划 vs 实际人数差异
- 候补人员筛选逻辑合理
- 两个新工作表数据完整
- 可能触发 Plan 模式进行多步规划

---

## 能力覆盖矩阵

| 任务 | read_excel | filter | vlookup | computed | run_code | format | chart | file_ops | 多轮 | 错误处理 |
|------|-----------|--------|---------|----------|----------|--------|-------|----------|------|----------|
| 1    | ✅        |        |         |          |          |        |       |          |      |          |
| 2    |           | ✅     |         |          | ✅       |        |       |          |      |          |
| 3    |           |        | ✅      |          |          |        |       |          |      |          |
| 4    |           |        |         | ✅       |          |        |       |          |      |          |
| 5    |           |        |         |          | ✅       |        |       |          |      |          |
| 6    |           |        |         |          | ✅       | ✅     |       |          |      |          |
| 7    |           |        |         |          | ✅       |        | ✅    |          |      |          |
| 8    | ✅        |        |         |          | ✅       |        |       |          |      |          |
| 9    |           |        |         |          |          |        |       | ✅       |      |          |
| 10   | ✅        |        |         |          | ✅       |        |       |          | ✅   |          |
| 11   |           | ✅     |         |          |          |        |       |          |      | ✅       |
| 12   | ✅        | ✅     |         |          | ✅       |        |       |          |      |          |

---

## 评分建议

每个任务按以下维度打分（1-5分）：

- **正确性**：结果是否准确
- **效率**：工具选择是否合理，步骤是否精简
- **鲁棒性**：遇到异常是否能自我修复
- **交互质量**：回复是否清晰、有条理
