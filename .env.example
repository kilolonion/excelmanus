# ExcelManus 配置示例
# 复制此文件为 .env 并填入真实值

# ── 必填配置项 ──
EXCELMANUS_API_KEY=your-api-key
EXCELMANUS_BASE_URL=https://your-llm-endpoint/v1
EXCELMANUS_MODEL=your-model-id

# ── AUX 模型（路由 + 子代理默认模型 + 窗口感知顾问，可选） ──
# EXCELMANUS_AUX_ENABLED=true
# EXCELMANUS_AUX_MODEL=your-aux-model
# EXCELMANUS_AUX_BASE_URL=https://your-aux-endpoint/v1
# EXCELMANUS_AUX_API_KEY=your-aux-api-key

# ── 子代理执行配置（可选） ──
# EXCELMANUS_SUBAGENT_ENABLED=true

# ── VLM 模型（图片表格提取，可选） ──
# EXCELMANUS_VLM_ENABLED=true
# EXCELMANUS_VLM_API_KEY=your-vlm-api-key
# EXCELMANUS_VLM_BASE_URL=https://your-vlm-endpoint/v1
# EXCELMANUS_VLM_MODEL=your-vlm-model
# EXCELMANUS_VLM_MAX_TOKENS=16384

# ── Embedding 模型（语义检索，可选） ──
# EXCELMANUS_EMBEDDING_API_KEY=your-embedding-api-key
# EXCELMANUS_EMBEDDING_BASE_URL=https://your-embedding-endpoint/v1
# EXCELMANUS_EMBEDDING_MODEL=text-embedding-v3
# EXCELMANUS_EMBEDDING_DIMENSIONS=1536

# ── 多模型配置（已迁移至数据库管理，通过 Web 设置页面或 /model 命令操作） ──
# 注意：EXCELMANUS_MODELS 环境变量已废弃。首次启动时若存在会自动迁移到数据库并从 .env 中清除。

# ── 工作区与安全 ──
# EXCELMANUS_WORKSPACE_ROOT=.
# EXCELMANUS_EXTERNAL_SAFE_MODE=true
# CORS 允许来源（逗号分隔）。
# 本地开发默认 http://localhost:3000,http://localhost:5173
# 生产部署时必须添加前端域名，否则浏览器直连后端的 SSE 请求会被 CORS 拦截。
# 示例: EXCELMANUS_CORS_ALLOW_ORIGINS=https://kilon.top,http://localhost:3000
# EXCELMANUS_CORS_ALLOW_ORIGINS=http://localhost:3000,http://localhost:5173
# Docker 沙盒（默认关闭，需预先构建镜像：docker build -t excelmanus-sandbox:latest -f Dockerfile.sandbox .）
# EXCELMANUS_DOCKER_SANDBOX=false

# ── 备份与轮次快照（可选） ──
# 备份沙盒模式：文件操作前自动创建备份副本（默认开启）
# EXCELMANUS_BACKUP_ENABLED=true
# 轮次 checkpoint 模式：每轮工具调用后自动快照被修改文件，支持按轮回退（默认关闭）
# EXCELMANUS_CHECKPOINT_ENABLED=false

# ── 文本回复门禁模式（可选） ──
# off（默认）：完全关闭执行守卫和写入门禁，agent 可自然停止，避免空转 token
# soft：保留门禁但降级为仅记录诊断事件，不强制 agent 继续执行
# EXCELMANUS_GUARD_MODE=off

# ── 工具参数 schema 校验（可选） ──
# off=关闭（默认），shadow=仅日志不阻断，enforce=阻断并返回错误
# EXCELMANUS_TOOL_SCHEMA_VALIDATION_MODE=off
# enforce 模式灰度比例（0~100），100=全量
# EXCELMANUS_TOOL_SCHEMA_VALIDATION_CANARY_PERCENT=100
# 严格路径策略：开启后路径参数必须为相对路径且禁止 ..
# EXCELMANUS_TOOL_SCHEMA_STRICT_PATH=false

# ── 上下文优化（可选） ──
# EXCELMANUS_MAX_CONTEXT_TOKENS=128000
# EXCELMANUS_SUMMARIZATION_ENABLED=true
# EXCELMANUS_COMPACTION_ENABLED=true

# ── Hook 配置（可选） ──
# EXCELMANUS_HOOKS_COMMAND_ENABLED=false
# EXCELMANUS_HOOKS_COMMAND_ALLOWLIST=

# ── 窗口感知层（可选） ──
# EXCELMANUS_WINDOW_PERCEPTION_ENABLED=true
# EXCELMANUS_WINDOW_PERCEPTION_ADVISOR_MODE=hybrid

# ── 统一数据库（可选） ──
# EXCELMANUS_DB_PATH=~/.excelmanus/excelmanus.db

# ── 聊天记录持久化（可选） ──
# EXCELMANUS_CHAT_HISTORY_ENABLED=true

# ── OpenAI Responses API 模式（可选） ──
# 设为 1 启用 Responses API（/responses 端点），仅对非 Gemini/Claude 的 OpenAI 兼容 URL 生效
# EXCELMANUS_USE_RESPONSES_API=1

# ── 认证与多用户（可选） ──
# 设为 true 启用认证中间件（强制所有 API 请求携带 JWT token）
# EXCELMANUS_AUTH_ENABLED=false
# 会话用户隔离（默认关闭，需先启用认证；管理员可在运行时通过 API 开启）
# EXCELMANUS_SESSION_ISOLATION=false
# JWT 签名密钥（留空则每次重启自动生成，生产环境务必设置固定值）
# EXCELMANUS_JWT_SECRET=your-random-secret-key-at-least-64-chars

# ── OAuth 登录（可选，需在对应平台创建 OAuth App） ──
# GitHub OAuth
# EXCELMANUS_GITHUB_CLIENT_ID=
# EXCELMANUS_GITHUB_CLIENT_SECRET=
# EXCELMANUS_GITHUB_REDIRECT_URI=http://localhost:3000/api/v1/auth/oauth/github/callback
# Google OAuth
# EXCELMANUS_GOOGLE_CLIENT_ID=
# EXCELMANUS_GOOGLE_CLIENT_SECRET=
# EXCELMANUS_GOOGLE_REDIRECT_URI=http://localhost:3000/api/v1/auth/oauth/google/callback
# QQ 互联 OAuth（https://connect.qq.com）
# EXCELMANUS_QQ_CLIENT_ID=
# EXCELMANUS_QQ_CLIENT_SECRET=
# EXCELMANUS_QQ_REDIRECT_URI=http://localhost:3000/api/v1/auth/oauth/qq/callback

# ── 邮件验证码（可选） ──
# 设为 true 时注册须完成邮箱验证，需同时配置下方邮件发送方式
# EXCELMANUS_EMAIL_VERIFY_REQUIRED=false
# 发件人显示名 + 地址（覆盖默认值）
# EXCELMANUS_EMAIL_FROM=ExcelManus <no-reply@yourdomain.com>

# 方式一：Resend（推荐，免费额度 3000 封/月）
# EXCELMANUS_RESEND_API_KEY=re_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# 方式二：SMTP（QQ / 网易 / Gmail / 企业邮箱等）
# EXCELMANUS_SMTP_HOST=smtp.qq.com
# EXCELMANUS_SMTP_PORT=465        # 465 = SSL, 587 = STARTTLS
# EXCELMANUS_SMTP_USER=xxx@qq.com
# EXCELMANUS_SMTP_PASSWORD=your-app-password

# ── 工作空间配额（可选，面向公众服务时建议配置） ──
# 每个用户工作空间最大存储容量（MB），超出后上传将被拒绝
# EXCELMANUS_WORKSPACE_MAX_SIZE_MB=100
# 每个用户工作空间最大文件数，超出后自动删除最旧的文件
# EXCELMANUS_WORKSPACE_MAX_FILES=5
