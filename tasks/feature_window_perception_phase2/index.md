# 任务：窗口感知层 Phase 2（小模型接入）

> **类型**：feature
> **优先级**：P1
> **负责人**：AreaSongWcc
> **状态**：✅ 已完成
> **开始时间**：2026-02-14
> **预计完成**：2026-02-14

## 🎯 目标
在不改变主 Agent 工具调用方式的前提下，为窗口感知层接入小模型顾问，采用「规则兜底 + 异步缓存 + 下轮生效」策略，提升多窗口场景上下文质量并保持主链路无阻塞。

## 📊 进度仪表盘
| 阶段 | 状态 | 文档链接 |
|------|------|----------|
| R1 调研 | ✅ | 已完成（代码现状勘察） |
| I 设计 | ✅ | 已完成（方案冻结） |
| P 规划 | ✅ | [P_plan.md](./P_plan.md) |
| E 执行 | ✅ | [E_execution.md](./E_execution.md) |
| R2 验收 | ✅ | [R2_review.md](./R2_review.md) |

## 📝 关键决策
- 默认启用 `hybrid` 顾问模式。
- 复用 Router 小模型链路（`_router_client/_router_model`）。
- 异步触发不阻塞主链路，规则顾问为硬兜底。
- 小模型计划必须通过严格校验后才可生效。

## 🚨 风险与问题
- 风险：异步任务若泄漏可能造成会话残留协程。
- 处置：在 `WindowPerceptionManager.reset()` 中取消任务并清缓存。
